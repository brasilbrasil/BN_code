overwrite=1
all_combined_file=paste("results/",project_name,"_","all_combined.csv",sep="")
data=read.csv(all_combined_file, stringsAsFactors=FALSE)
min_n_per_group=20
dir.create(paste("comparisons/n_", min_n_per_group,"/", sep=""),showWarnings=FALSE)
#to_plot=c("transformed", "Dispersion", "Resist", "Migrate", "Micro_refugia", "Habitat_qual_MRF", "Tol_Zone_Habitat_qual", "Mig_Zone_Habitat_qual")
to_plot=c("transformed")
to_plot_names=c("Vulnerability", "Dispersion", "Tolerate", "Migrate", "Micro refugia", "Micro refugia zone habitat quality", "Tolerate zone habitat quality",
                "Migrate zone habitat quality")
#to_plot=c("transformed")#, "Dispersion", "Resist", "Migrate", "Micro_refugia", "Habitat_qual_MRF", "Tol_Zone_Habitat_qual", "Mig_Zone_Habitat_qual")

#DEBUG
# plot0="Habitat_qual_MRF"
# group=data$Status.simplified
# data=data[ ,plot0]
# min_n_per_group
# plot_name=paste(plot0,"_by_","Conservation_status",sep="")
# factor_order=NULL
# tilt=NULL
# labels=NULL

#graph order is dangerous: it must reflect exactly the number of factors included in the anova and plot data, or else miss labels will occur
library(reshape2)
library(plyr)

Transform_anova_and_tukey <- function(group, data, min_n_per_group,plot_name=NULL, factor_order=NULL, tilt=NULL, labels=NULL, ynames="response") {
  ###debug
#   plot0=to_plot[1]
#   plot_name=paste(plot0,"_by_","Coastal",sep="")
#   csv_name=paste("comparisons/n_", min_n_per_group,"/", project_name,"_", plot_name,"_anova_mat.csv", sep="")
#   group=data$Coastal
#   data=data[ ,plot0] 
#   min_n_per_group=min_n_per_group
#   plot_name=plot_name 
#   factor_order=NULL
#   tilt=NULL
#   labels=NULL
  ### end debug
  
  anova_results_mat=c()
  Tukey_results=c()
  group=as.factor(group)
  temp.data=data.frame(group)
  temp.data=cbind(temp.data, data)  
  temp.data0=temp.data
  
  jnk=temp.data[,1]
  unique.Dataset=unique(jnk)
  n.unique.Dataset=length(unique.Dataset)
  
  for (jj in 1:n.unique.Dataset){ 
    jnk2=which(temp.data[,1]==unique.Dataset[jj])
    if (length(jnk2)<min_n_per_group){
      temp.data=temp.data[-jnk2,]
    }  
  }
  jnk=temp.data[,1]
  unique.Dataset=unique(jnk)
  n.unique.Dataset=length(unique.Dataset)
  temp.data[,2]=as.double(temp.data[,2])
  #temp.data[,1]=factor(temp.data[,1])
  
  data_available=0
  transformed=0
  transform.log=0
  transform.sqrt=0
  transform.cbrt=0
  transform.further=0
  
  n =1
  for (n in 1:n.unique.Dataset){        
    temp.data5=as.double(temp.data[temp.data[,1]==unique.Dataset[n],2])
    jnk=shapiro.test(temp.data5)
    if (jnk$p.value<=0.05){
      transform.log=1
      break} 
    else {transformed=0}   
  }
  
  if (transform.log==1) {
    for (n in 1:n.unique.Dataset){         
      temp.data5=as.double(temp.data[temp.data[,1]==unique.Dataset[n],2])
      temp.data5=log(temp.data5+1)
      jnk=shapiro.test(temp.data5)
      if (jnk$p.value<=0.05){
        transform.sqrt=1
        break
      } else {
        transformed=1
      }
    }
  }
  
  if (transform.sqrt==1) {
    for (n in 1:n.unique.Dataset){         
      temp.data5=as.double(temp.data[temp.data[,1]==unique.Dataset[n],2])
      temp.data5=sqrt(temp.data5)
      jnk=shapiro.test(temp.data5)
      if (jnk$p.value<=0.05){
        transform.cbrt=1
        break
      }else {transformed=2}
    }
  }
  
  if (transform.cbrt==1) {
    for (n in 1:n.unique.Dataset){         
      temp.data5=as.double(temp.data[temp.data[,1]==unique.Dataset[n],2])
      temp.data5=(temp.data5)^(1/3)
      jnk=shapiro.test(temp.data5)
      if (jnk$p.value<=0.05){transformed=4
                             break} 
      else {transformed=3}
    }
  }
  
  if (transformed==1){temp.data[,2]=log(temp.data[,2]+1)} 
  if (transformed==2){temp.data[,2]=sqrt(temp.data[,2])} 
  if (transformed==3){temp.data[,2]=(temp.data[,2])^(1/3)} 
  if (transformed==4){temp.data[,2]=rank(temp.data[,2],ties.method="average")}
  ynames1=ynames
  
  if (n.unique.Dataset>1){
    dimnames(temp.data)[[2]]<- c( "Group", "Data")
    temp.data=data.frame(temp.data)
    temp.data$Group=factor(temp.data$Group)
    anova_results=aov(Data~Group,data=temp.data)
    anova_results2=anova(anova_results)
    anova_results2=anova_results2[1, ]
    anova_significance=anova_results2[1,"Pr(>F)"]
    significant=anova_significance[1]<=0.05
    
    anova_results_mat=cbind(transformed,anova_results2)
    if (significant==1) {
      if (n.unique.Dataset>2){
        Tukey_results=TukeyHSD(anova_results,"Group")
        Tukey_results=Tukey_results$Group
        significant=min(Tukey_results[,"p adj"])<=0.05 
      }
    }  
    if (!is.null(plot_name)){
      jpeg_name=paste("comparisons/n_", min_n_per_group,"/", project_name,"_",plot_name,".jpeg", sep="")
      jpeg(jpeg_name,
           width = 6, height = 6, units = "in",
           pointsize = 12, quality = 90, bg = "white", res = 300)
      
      if (!is.null(factor_order)){
        temp.data0[,1]=factor(temp.data0[,1], factor_order)
      }
      
      if (!is.null(tilt)){
        par(xaxt="n")
        plot(temp.data0[,1], temp.data0[,2],ylab=ynames1) #ylab="Angiosperm abundance per sample", xlab="Site", ylim=c(0,ylim_value)
      }else{
        par(oma = c(8, 0, 0, 0))#if (!is.null(tilt)){par(xaxt="n")}
        plot(temp.data0[,1], temp.data0[,2], las=3, xlab="", ylab=ynames1) #ylab="Angiosperm abundance per sample", xlab="Site", ylim=c(0,ylim_value)      
      }
      
      if (!is.null(tilt)){
        if (is.null(labels)){
          lablist.x<-levels(temp.data0[,1])
        }else{
          lablist.x<-labels
        }
        axis(1, at=seq(1, length(lablist.x), by=1), labels = FALSE)
        text(x = seq(1, length(lablist.x), by=1), par("usr")[3] - 0.05, labels = lablist.x, srt = tilt, pos = 1, xpd = TRUE)
      }
      dev.off()
      
      if (significant==1 & n.unique.Dataset>2) {
        #       jpeg_name=paste("comparisons/n_", min_n_per_group,"/", plot_name,"_Tukey.jpeg", sep="")
        #       jpeg(jpeg_name,
        #            width = 6, height = 6, units = "in",
        #            pointsize = 12, quality = 90, bg = "white", res = 300)
        #       par(mar=c(2.1, 15.1, 2.1, 2.1))
        #       #par(xpd=FALSE)
        #       plot(TukeyHSD(anova_results,"Group"), las=1) #ylab="Angiosperm abundance per sample", xlab="Site", ylim=c(0,ylim_value)
        #       dev.off()
        #       
        #       jpeg_name=paste("comparisons/n_", min_n_per_group,"/", plot_name,"_grouped_treatments.jpeg", sep="")
        #       jpeg(jpeg_name,
        #            width = 8, height = 8, units = "in",
        #            pointsize = 12, quality = 90, bg = "white", res = 300)
        #       library(multcomp)
        #       tuk <- glht(anova_results, linfct = mcp(Group = "Tukey"))
        #       summary(tuk)          # standard display
        #       tuk.cld <- cld(tuk)   # letter-based display
        #       #opar <- par(mai=c(1,1,1.5,1))
        #       opar <- par()      
        #       par(oma = c(6, 0, 2, 0))#if (!is.null(tilt)){par(xaxt="n")}
        #       plot(tuk.cld, las=3, xlab="")#, axis(1, las=3)) # ; axis(1, las=3); 
        #       par(opar)
        #       dev.off()
        
        library(multcompView)
        
        jpeg_name=paste("comparisons/n_", min_n_per_group,"/", project_name,"_", plot_name,"_grouped_treatments3.jpeg", sep="")
        jpeg(jpeg_name,
             width = 8, height = 8, units = "in",
             pointsize = 12, quality = 90, bg = "white", res = 300)
        opar <- par()  
        par(oma = c(8, 0, 0, 0))
        xzx <-multcompBoxplot(Data~Group,data=temp.data,sortFn=median,  decreasing=FALSE, horizontal=FALSE,ylab=ynames1,
                              plotList=list(
                                boxplot=list(fig=c(0,  1,  0,  1),  las=3,
                                             cex.axis=1.5),
                                
                                multcompLetters=list(
                                  fig=c(0.87,  0.97,  0.115,  0.923), #0.1108, 0.9432 Top of page 18 manual for very convoluted explanation (c(y bottom, y top,x L, x R))
                                  type='Letters') ) )
        par(opar)
        dev.off()
        
      }
    }
    #summary stats  
    summary_stats=tapply(temp.data0[,2], temp.data0[,1], mean, na.rm = TRUE)
    summary_stats=rbind(summary_stats,tapply(temp.data0[,2], temp.data0[,1], function(x) length(unique(x))))
    summary_stats=rbind(summary_stats,tapply(temp.data0[,2], temp.data0[,1], sd, na.rm = TRUE))
    summary_stats=rbind(summary_stats, tapply(temp.data0[,2], temp.data0[,1], median, na.rm = TRUE))
    row.names(summary_stats)=c("mean", "count", "standard deviation", "median")
    summary_stats=t(summary_stats)
    summary_stats=summary_stats[order(summary_stats[,1], decreasing = TRUE),]
    csv_name=paste("comparisons/n_", min_n_per_group,"/", project_name,"_", plot_name,"_summary_stats.csv", sep="")
    write.csv(summary_stats, csv_name, row.names=TRUE)
    csv_name=paste("comparisons/n_", min_n_per_group,"/", project_name,"_", plot_name,"_anova_mat.csv", sep="")
    write.csv(anova_results_mat, csv_name, row.names=TRUE)
    csv_name=paste("comparisons/n_", min_n_per_group,"/", project_name,"_", plot_name,"_Tukey_mat.csv", sep="")
    write.csv(Tukey_results, csv_name, row.names=TRUE)  
    return(list(anova_results_mat, Tukey_results))    
  }
}

plot0=to_plot[1]
for (plot0 in to_plot){
  plot_name=paste(plot0,"_by_","Native_status",sep="")
  var_nm=to_plot_names[which(to_plot==plot0)]
  csv_name=paste("comparisons/n_", min_n_per_group,"/", project_name,"_", plot_name,"_anova_mat.csv", sep="")
  if (file.exists(csv_name)==F | overwrite==1){
    temp_res=Transform_anova_and_tukey(data$Native.Status, data[ ,plot0], min_n_per_group,plot_name=plot_name, factor_order=NULL, tilt=NULL, labels=NULL, ynames=to_plot_names[which(to_plot==plot0)])
    assign("anova_results_mat", temp_res[[1]])
    assign("Tukey_results", temp_res[[2]])
    cat('\n',plot_name,'done...')
  }else{
    cat('\n',plot_name,'previously done...')
  }
  
  plot_name=paste(plot0,"_by_","Conservation_status",sep="")
  csv_name=paste("comparisons/n_", min_n_per_group,"/", project_name,"_", plot_name,"_anova_mat.csv", sep="")
  if (file.exists(csv_name)==F | overwrite==1){
    ordered_factors=c("Apparently Secure", "Vulnerable", "Rare", "Endangered", "Extinct")
    temp_res=Transform_anova_and_tukey(data$Status.simplified, data[ ,plot0], min_n_per_group=min_n_per_group,plot_name=plot_name, factor_order=ordered_factors, tilt=NULL, labels=NULL, ynames=to_plot_names[which(to_plot==plot0)])
    assign("anova_results_mat", temp_res[[1]])
    assign("Tukey_results", temp_res[[2]])
    cat('\n',plot_name,'done...')
  }else{
    cat('\n',plot_name,'previously done...')
  }
  
  plot_name=paste(plot0,"_by_","Division",sep="")
  csv_name=paste("comparisons/n_", min_n_per_group,"/", project_name,"_",plot_name,"_anova_mat.csv", sep="")
  if (file.exists(csv_name)==F | overwrite==1){
    temp_res=Transform_anova_and_tukey(data$DIVISION, data[ ,plot0], min_n_per_group,plot_name=plot_name,factor_order=NULL, tilt=NULL, labels=NULL, ynames=to_plot_names[which(to_plot==plot0)])
    assign("anova_results_mat", temp_res[[1]])
    assign("Tukey_results", temp_res[[2]])
    cat('\n',plot_name,'done...')
  }else{
    cat('\n',plot_name,'previously done...')
  }
  
  plot_name=paste(plot0,"_by_","Family",sep="")
  csv_name=paste("comparisons/n_", min_n_per_group,"/", project_name,"_", plot_name,"_anova_mat.csv", sep="")
  if (file.exists(csv_name)==F | overwrite==1){
    temp_res=Transform_anova_and_tukey(data$FAMILY, data[ ,plot0], min_n_per_group,plot_name=plot_name, factor_order=NULL, tilt=NULL, labels=NULL, ynames=to_plot_names[which(to_plot==plot0)])
    assign("anova_results_mat", temp_res[[1]])
    assign("Tukey_results", temp_res[[2]])
    cat('\n',plot_name,'done...')
  }else{
    cat('\n',plot_name,'previously done...')
  }
  
  plot_name=paste(plot0,"_by_","Genus",sep="")
  csv_name=paste("comparisons/n_", min_n_per_group,"/", project_name,"_", plot_name,"_anova_mat.csv", sep="")
  if (file.exists(csv_name)==F | overwrite==1){
    temp_res=Transform_anova_and_tukey(data$GENUS, data[ ,plot0], min_n_per_group,plot_name=plot_name, factor_order=NULL, tilt=NULL, labels=NULL, ynames=to_plot_names[which(to_plot==plot0)])
    assign("anova_results_mat", temp_res[[1]])
    assign("Tukey_results", temp_res[[2]])
    cat('\n',plot_name,'done...')
  }else{
    cat('\n',plot_name,'previously done...')
  }
  
  plot_name=paste(plot0,"_by_","Pioneer",sep="")
  csv_name=paste("comparisons/n_", min_n_per_group,"/", project_name,"_", plot_name,"_anova_mat.csv", sep="")
  if (file.exists(csv_name)==F | overwrite==1){
    pioneer_class=data$Pioneer
    pioneer_class[pioneer_class==0]="Non-pioneer"
    pioneer_class[pioneer_class=="1"]="Pioneer"    
    temp_res=Transform_anova_and_tukey(pioneer_class, data[ ,plot0], min_n_per_group,plot_name=plot_name, factor_order=NULL, tilt=NULL, labels=NULL, ynames=to_plot_names[which(to_plot==plot0)])
    assign("anova_results_mat", temp_res[[1]])
    assign("Tukey_results", temp_res[[2]])
    cat('\n',plot_name,'done...')
  }else{
    cat('\n',plot_name,'previously done...')
  }
  
  plot_name=paste(plot0,"_by_","Alien_hab_compatibility",sep="")
  csv_name=paste("comparisons/n_", min_n_per_group,"/", project_name,"_", plot_name,"_anova_mat.csv", sep="")
  if (file.exists(csv_name)==F | overwrite==1){
    Alien_hab_comp_class=data$Alien_hab_comp
    Alien_hab_comp_class[Alien_hab_comp_class==0]="Require native habitat"
    Alien_hab_comp_class[Alien_hab_comp_class=="1"]="Persist in non-native habitat"    
    temp_res=Transform_anova_and_tukey(Alien_hab_comp_class, data[ ,plot0], min_n_per_group,plot_name=plot_name, factor_order=NULL, tilt=NULL, labels=NULL, ynames=to_plot_names[which(to_plot==plot0)])
    assign("anova_results_mat", temp_res[[1]])
    assign("Tukey_results", temp_res[[2]])
    cat('\n',plot_name,'done...')
  }else{
    cat('\n',plot_name,'previously done...')
  }
  plot_name=paste(plot0,"_by_","Coastal",sep="")
  csv_name=paste("comparisons/n_", min_n_per_group,"/", project_name,"_", plot_name,"_anova_mat.csv", sep="")
  if (file.exists(csv_name)==F | overwrite==1){
    temp_res=Transform_anova_and_tukey(data$Coastal, data[ ,plot0], min_n_per_group,plot_name=plot_name, factor_order=NULL, tilt=NULL, labels=NULL, ynames=to_plot_names[which(to_plot==plot0)])
    assign("anova_results_mat", temp_res[[1]])
    assign("Tukey_results", temp_res[[2]])
    cat('\n',plot_name,'done...')
  }else{
    cat('\n',plot_name,'previously done...')
  }
  
  #by cover type
  #by most dominant
  #ordered_factors=c( 'Evergreen_shrubland', 'Dry_forest', 'Mesic_forest', 'Wet_mesic_forest', 'Decidious_shrubland', 'Alpine_shrubland', 'Dry_shrubland', 'Wet_forest', 'Perennial_grassland')
  data_temp=data
  to_del=which(data_temp$dominant_cover=='na')
  data_temp=data_temp[-to_del,]
  plot_name=paste(plot0,"_by_","dominant_cover",sep="")
  csv_name=paste("comparisons/n_", min_n_per_group,"/", project_name,"_", plot_name,"_anova_mat.csv", sep="")
  if (file.exists(csv_name)==F | overwrite==1){
    ordered_factors=c('Evergreen_shrubland', 'Mesic_forest',  'Dry_forest',  'Decidious_shrubland', 'Wet_mesic_forest', 'Dry_shrubland', 'Perennial_grassland', 'Wet_forest')
    temp_res=Transform_anova_and_tukey(data_temp$dominant_cover, data_temp[ ,plot0], min_n_per_group,plot_name=plot_name, factor_order=ordered_factors, tilt=NULL, labels=NULL, ynames=to_plot_names[which(to_plot==plot0)])
    assign("anova_results_mat", temp_res[[1]])
    assign("Tukey_results", temp_res[[2]])
    cat('\n',plot_name,'done...')
  }else{
    cat('\n',plot_name,'previously done...')
  }
  
  #by cover type
  #by most prevalent
  plot_name=paste(plot0,"_by_","primary_cover",sep="")
  csv_name=paste("comparisons/n_", min_n_per_group,"/", project_name,"_", plot_name,"_anova_mat.csv", sep="")
  if (file.exists(csv_name)==F | overwrite==1){
    ordered_factors=c( 'Evergreen_shrubland', 'Dry_forest', 'Mesic_forest', 'Wet_mesic_forest', 'Decidious_shrubland', 'Alpine_shrubland', 'Dry_shrubland', 'Wet_forest', 'Perennial_grassland')
    temp_res=Transform_anova_and_tukey(data$cover1, data[ ,plot0], min_n_per_group,plot_name=plot_name, factor_order=ordered_factors, tilt=NULL, labels=NULL, ynames=to_plot_names[which(to_plot==plot0)])
    assign("anova_results_mat", temp_res[[1]])
    assign("Tukey_results", temp_res[[2]])
    cat('\n',plot_name,'done...')
  }else{
    cat('\n',plot_name,'previously done...')
  }
  #by top 3 most prevalent
  
#   library(reshape2)
#   library(plyr)
#   main_cover_types=c('main_Alpine_shrubland', 'main_Decidious_shrubland', 'main_Dry_forest', 'main_Dry_grassland', 'main_Dry_shrubland', 'main_Evergreen_shrubland', 'main_Mesic_forest', 'main_Mesic_grassland', 'main_Mesic_shrubland', 'main_Perennial_grassland', 'main_Wet_forest', 'main_Wet_mesic_forest', 'main_Wetland_coastal')
#   cover_ranks=c("cover1","cover2","cover3")
#   temp_data=data[,c(cover_ranks,plot0)]
#   temp_data=melt(temp_data, id=c(plot0))
#   
#   plot_name=paste(plot0,"_by_","primary_3covers",sep="")
#   csv_name=paste("comparisons/n_", min_n_per_group,"/", plot_name,"_anova_mat.csv", sep="")
#   if (file.exists(csv_name)==F | overwrite==1){
#     ordered_factors=c('Wetland_coastal', 'Alpine_shrubland', 'Evergreen_shrubland', 'Mesic_shrubland', 'Mesic_grassland', 'Decidious_shrubland', 'Dry_forest', 'Mesic_forest', 'Wet_mesic_forest', 'Wet_forest', 'Perennial_grassland', 'Dry_shrubland')
#     #ordered_factors=c('Wetland_coastal', 'Alpine_shrubland', 'Evergreen_shrubland', 'Mesic_shrubland', 'Mesic_grassland', 'Decidious_shrubland', 'Dry_forest', 'Mesic_forest', 'Wet_mesic_forest', 'Dry_shrubland', 'Wet_forest', 'Perennial_grassland', 'Dry_grassland')
#     temp_res=Transform_anova_and_tukey(temp_data$value, temp_data[ ,plot0], min_n_per_group,plot_name=plot_name, factor_order=ordered_factors, tilt=NULL, labels=NULL)
#     assign("anova_results_mat", temp_res[[1]])
#     assign("Tukey_results", temp_res[[2]])
#     cat('\n',plot_name,'done...')
#   }else{
#     cat('\n',plot_name,'previously done...')
#   }
  
  #by island
  islands=c("Ha", "Ma", "Ka", "Oa", "Mo", "La", "Ke", "Ni")
  temp_data=data[,c(islands,plot0)]
  island=islands[1]
  i=1
  for (island in islands){
    jnk=temp_data[,i]
    jnk[jnk>0]=island
    jnk[jnk<=0]="na"
    temp_data[,i]=jnk
    i=i+1  
  }
  temp_data1=melt(temp_data, id=c(plot0))
  temp_data1=temp_data1[temp_data1$value!="na",]
  
#   plot_name=paste(plot0,"_by_","islands_by_age",sep="")
#   csv_name=paste("comparisons/n_", min_n_per_group,"/", plot_name,"_anova_mat.csv", sep="")
#   if (file.exists(csv_name)==F | overwrite==1){
#     ordered_factors=c("Ha", "Ma", "Ke", "La", "Mo", "Oa",  "Ka", "Ni")
#     plot_labels=c("Hawaii", "Maui", "Kahoolawe", "Lanai", "Molokai", "Oahu",  "Kauai", "Nihau")
#     temp_res=Transform_anova_and_tukey(temp_data1$value, temp_data1[ ,plot0], min_n_per_group,plot_name=plot_name, factor_order=ordered_factors, tilt=NULL, labels=plot_labels)
#     assign("anova_results_mat", temp_res[[1]])
#     assign("Tukey_results", temp_res[[2]])
#     cat('\n',plot_name,'done...')
#   }else{
#     cat('\n',plot_name,'previously done...')
#   }
  
  plot_name=paste(plot0,"_by_","islands_by_size",sep="")
  csv_name=paste("comparisons/n_", min_n_per_group,"/", project_name,"_", plot_name,"_anova_mat.csv", sep="")
  if (file.exists(csv_name)==F | overwrite==1){
    ordered_factors=c("Ha", "Ma", "Oa", "Ka", "Mo", "La",  "Ni", "Ke")
    plot_labels=c("Hawaii", "Maui", "Oahu", "Kauai", "Molokai", "Lanai", "Nihau", "Kahoolawe")
    temp_res=Transform_anova_and_tukey(temp_data1$value, temp_data1[ ,plot0], min_n_per_group,plot_name=plot_name, factor_order=ordered_factors, tilt=NULL, labels=plot_labels, ynames=to_plot_names[which(to_plot==plot0)])
    cat('\n',plot_name,'done...')
  }else{
    cat('\n',plot_name,'previously done...')
  }
  
  ############by island, only single island endemics
  islands=c("Ha", "Ma", "Ka", "Oa", "Mo", "La", "Ke", "Ni")
  jnk=data[,islands]
  jnk[jnk>0]=1
  temp_data=cbind(jnk, val=data[,plot0])
  jnk=rowSums(temp_data[,islands])
  temp_data=temp_data[jnk==1,]
  
  island=islands[1]
  i=1
  for (island in islands){
    jnk=temp_data[,i]
    jnk[jnk>0]=island
    jnk[jnk<=0]="na"
    temp_data[,i]=jnk
    i=i+1  
  }
  
  ordered_factors=c("Ha", "Ma", "Ke", "La", "Mo", "Oa",  "Ka", "Ni")
  plot_labels=c("Hawaii", "Maui", "Kahoolawe", "Lanai", "Molokai", "Oahu",  "Kauai", "Nihau")
  temp_data1=melt(temp_data, id=c("val"))
  temp_data1=temp_data1[temp_data1$value!="na",]
  
  
#   plot_name=paste(plot0,"_by_","islands_endemics_only_by_age",sep="")
#   csv_name=paste("comparisons/n_", min_n_per_group,"/", plot_name,"_anova_mat.csv", sep="")
#   if (file.exists(csv_name)==F | overwrite==1){
#     temp_res=Transform_anova_and_tukey(temp_data1$value, temp_data1[ ,"val"], min_n_per_group,plot_name=plot_name, factor_order=ordered_factors, tilt=NULL, labels=plot_labels)
#     assign("anova_results_mat", temp_res[[1]])
#     assign("Tukey_results", temp_res[[2]])
#     cat('\n',plot_name,'done...')
#   }else{
#     cat('\n',plot_name,'previously done...')
#   }
#   
#   plot_name=paste(plot0,"_by_","islands_endemics_only_by_size",sep="")
#   csv_name=paste("comparisons/n_", min_n_per_group,"/", plot_name,"_anova_mat.csv", sep="")
#   if (file.exists(csv_name)==F | overwrite==1){
#     ordered_factors=c("Ha", "Ma", "Oa", "Ka", "Mo", "La",  "Ni", "Ke")
#     plot_labels=c("Hawaii", "Maui", "Oahu", "Kauai", "Molokai", "Lanai", "Nihau", "Kahoolawe")
#     temp_res=Transform_anova_and_tukey(temp_data1$value, temp_data1[ ,"val"], min_n_per_group,plot_name=plot_name, factor_order=ordered_factors, tilt=NULL, labels=plot_labels)
#     cat('\n',plot_name,'done...')
#   }else{
#     cat('\n',plot_name,'previously done...')
#   }
  
  plot_name=paste(plot0,"_by_","islands_endemics_only_by_elev",sep="")
  csv_name=paste("comparisons/n_", min_n_per_group,"/", project_name,"_", plot_name,"_anova_mat.csv", sep="")
  if (file.exists(csv_name)==F | overwrite==1){
    ordered_factors=c("Ha", "Ma", "Ka", "Mo", "Oa", "La",  "Ni", "Ke")
    plot_labels=c("Hawaii", "Maui", "Kauai", "Molokai", "Oahu", "Lanai", "Nihau", "Kahoolawe")
    temp_res=Transform_anova_and_tukey(temp_data1$value, temp_data1[ ,"val"], min_n_per_group,plot_name=plot_name, factor_order=ordered_factors, tilt=NULL, labels=plot_labels)  
    cat('\n',plot_name,'done...')
  }else{
    cat('\n',plot_name,'previously done...')
  }  
  
  ###single island endemics vs all else
  islands=c("Ha", "Ma", "Ka", "Oa", "Mo", "La", "Ke", "Ni")
  jnk=data[,islands]
  jnk[jnk>0]=1
  temp_data=cbind(jnk, val=data[,plot0])
  temp_data=cbind(jnk, val=data[,plot0], single_island="Single island endemics")
  temp_data[,"single_island"]=factor(temp_data[,"single_island"], c("Single island endemics", "All else"))
  jnk=rowSums(temp_data[,islands])
  temp_data[which(jnk!=1),"single_island"]="All else"

  plot_name=paste(plot0,"_by_","islands_endemics_vs_all_else",sep="")
  csv_name=paste("comparisons/n_", min_n_per_group,"/", project_name,"_", plot_name,"_anova_mat.csv", sep="")
  if (file.exists(csv_name)==F | overwrite==1){
    temp_res=Transform_anova_and_tukey(temp_data$single_island, data[ ,plot0], min_n_per_group,plot_name=plot_name, factor_order=NULL, tilt=NULL, labels=NULL)
    assign("anova_results_mat", temp_res[[1]])
    assign("Tukey_results", temp_res[[2]])
    cat('\n',plot_name,'done...')
  }else{
    cat('\n',plot_name,'previously done...')
  }
}
